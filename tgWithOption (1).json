{
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1360,
        208
      ],
      "id": "4426ab3f-c1ca-4766-a892-6bf6d35eaef1",
      "name": "Telegram Trigger",
      "webhookId": "db400580-38f0-49e9-8422-48bc11ca0e62",
      "credentials": {
        "telegramApi": {
          "id": "NfxQdmu4lR5W3aCC",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst inputData = $input.item.json;\nconst message = inputData.message;\nconst chatId = message.chat.id;\nconst userName = message.from.first_name || \"–¥—Ä—É–≥\";\n\n// === –ü–†–û–í–ï–†–Ø–ï–ú –ï–°–¢–¨ –õ–ò –§–û–¢–û ===\nconst hasPhoto = message.photo && message.photo.length > 0;\n\nif (hasPhoto) {\n  // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ç–æ –≤ –ª—É—á—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤ –º–∞—Å—Å–∏–≤–µ)\n  const photo = message.photo[message.photo.length - 1];\n  const caption = message.caption || \"–û–±—ä—è—Å–Ω–∏ —á—Ç–æ –Ω–∞ —ç—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏\";\n  \n  return {\n    json: {\n      photoFileId: photo.file_id,\n      photoCaption: caption,\n      chatId: chatId,\n      userName: userName,\n      hasPhoto: true,\n      useAI: false  // false –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞\n    }\n  };\n}\n\n// === –ü–†–û–í–ï–†–Ø–ï–ú –¢–ï–ö–°–¢–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï ===\nconst text = message.text;\n\nif (!text) {\n  // –ï—Å–ª–∏ –Ω–∏ —Ñ–æ—Ç–æ –Ω–∏ —Ç–µ–∫—Å—Ç–∞\n  return {\n    json: {\n      response: \"–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–æ—Ç–æ, –∏ —è –ø–æ–º–æ–≥—É! üòä\",\n      chatId: chatId,\n      useAI: false\n    }\n  };\n}\n\n// === –ö–û–ú–ê–ù–î–´ (–∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ) ===\n\nif (text === '/start') {\n  const response = `–ü—Ä–∏–≤–µ—Ç, ${userName}! üëã\n\n–Ø —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É—á–µ–±—ã! üéì\n\nü§ñ –ß—Ç–æ —è —É–º–µ—é:\n- –û—Ç–≤–µ—á–∞—é –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n- –û–±—ä—è—Å–Ω—è—é —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã\n- –°–æ–∑–¥–∞—é —Ç–µ—Å—Ç—ã –ø–æ —Ç–µ–º–∞–º\n- –ü—Ä–æ–≤–µ—Ä—è—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É\n- üì∏ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–æ—Ç–æ (—Ñ–æ—Ä–º—É–ª—ã, –∫–æ–Ω—Å–ø–µ–∫—Ç—ã, –∑–∞–¥–∞—á–∏)\n- –†–∞–±–æ—Ç–∞—é –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º –∏ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–∞—Ö\n\nüìù –ö–æ–º–∞–Ω–¥—ã:\n/quiz [—Ç–µ–º–∞] - —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç\n/eli5 [—Ç–µ–º–∞] - –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ\n/check [—Ç–µ–∫—Å—Ç] - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É\n/help - –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã\n\nüí° –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ!\n\n–ù–∞–ø—Ä–∏–º–µ—Ä: \n‚úçÔ∏è \"–û–±—ä—è—Å–Ω–∏ —á—Ç–æ —Ç–∞–∫–æ–µ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑\"\nüì∏ [–§–æ—Ç–æ —Ñ–æ—Ä–º—É–ª—ã] \"–†–µ—à–∏ —ç—Ç–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ\"`;\n\n  return {\n    json: {\n      response: response,\n      chatId: chatId,\n      useAI: false\n    }\n  };\n}\n\nelse if (text === '/help') {\n  const response = `ü§ñ –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥:\n\nüìö –û–±—É—á–µ–Ω–∏–µ:\n/quiz [—Ç–µ–º–∞] - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –ø–æ —Ç–µ–º–µ\n/eli5 [—Ç–µ–º–∞] - –û–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ\n/check [—Ç–µ–∫—Å—Ç] - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É\n\nüì∏ –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ç–æ:\n–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é:\n- –§–æ—Ç–æ —Ñ–æ—Ä–º—É–ª—ã + \"—Ä–µ—à–∏\"\n- –§–æ—Ç–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ + \"–∫—Ä–∞—Ç–∫–æ\"\n- –§–æ—Ç–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º + \"–ø–µ—Ä–µ–≤–µ–¥–∏\"\n\n‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\n/about - –û –±–æ—Ç–µ\n/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\nüí° –°–æ–≤–µ—Ç: –ú–æ–∂–µ—à—å –ø—Ä–æ—Å—Ç–æ –ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –∫–æ–º–∞–Ω–¥!`;\n\n  return {\n    json: {\n      response: response,\n      chatId: chatId,\n      useAI: false\n    }\n  };\n}\n\nelse if (text === '/about') {\n  const response = `üìö AI Study Assistant\n\nüéì –¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É—á–µ–±—ã\n\n‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:\n- –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ª—é–±—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º\n- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º\n- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏\n- üì∏ –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ –∏ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤\n\nüöÄ –°–æ–∑–¥–∞–Ω–æ –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞ 2025\nüíª Powered by OpenAI GPT-4 Vision\n\n–ó–∞–¥–∞–≤–∞–π –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã - —è –∑–¥–µ—Å—å —á—Ç–æ–±—ã –ø–æ–º–æ—á—å! üòä`;\n\n  return {\n    json: {\n      response: response,\n      chatId: chatId,\n      useAI: false\n    }\n  };\n}\n\n// === –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –ö–û–ú–ê–ù–î–´ ===\n\nelse if (text.startsWith('/quiz ')) {\n  const topic = text.replace('/quiz ', '');\n  const prompt = `–°–æ–∑–¥–∞–π —Ç–µ—Å—Ç –∏–∑ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ —Ç–µ–º–µ \"${topic}\". \n–§–æ—Ä–º–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞:\n\n‚ùì –í–æ–ø—Ä–æ—Å?\nA) –í–∞—Ä–∏–∞–Ω—Ç 1\nB) –í–∞—Ä–∏–∞–Ω—Ç 2\nC) –í–∞—Ä–∏–∞–Ω—Ç 3\nD) –í–∞—Ä–∏–∞–Ω—Ç 4\n\n–í —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ —É–∫–∞–∂–∏: \"‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: 1-B, 2-A, 3-C, 4-D, 5-A\"`;\n\n  return {\n    json: {\n      question: prompt,\n      chatId: chatId,\n      useAI: true\n    }\n  };\n}\n\nelse if (text.startsWith('/eli5 ')) {\n  const topic = text.replace('/eli5 ', '');\n  return {\n    json: {\n      question: `–û–±—ä—è—Å–Ω–∏ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è–ª –¥–∞–∂–µ —Ä–µ–±—ë–Ω–æ–∫: ${topic}. –ò—Å–ø–æ–ª—å–∑—É–π –∞–Ω–∞–ª–æ–≥–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏.`,\n      chatId: chatId,\n      useAI: true\n    }\n  };\n}\n\nelse if (text.startsWith('/check ')) {\n  const checkText = text.replace('/check ', '');\n  return {\n    json: {\n      question: `–ü—Ä–æ–≤–µ—Ä—å —Ç–µ–∫—Å—Ç –Ω–∞ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤—å –∏—Ö. –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç - —Ç–∞–∫ –∏ –Ω–∞–ø–∏—à–∏. –¢–µ–∫—Å—Ç: \"${checkText}\"`,\n      chatId: chatId,\n      useAI: true\n    }\n  };\n}\n\n// === –û–ë–´–ß–ù–´–ï –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø (–ë–ï–ó AI) ===\n\nelse if (text.toLowerCase().includes('–ø—Ä–∏–≤–µ—Ç') || \n         text.toLowerCase().includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π') ||\n         text.toLowerCase().includes('—Å–∞–ª–∞–º') ||\n         text.toLowerCase().includes('—Å”ô–ª–µ–º') ||\n         text.toLowerCase().includes('hello') ||\n         text.toLowerCase().includes('—Å–∞–ª–∞–º–∞–ª–µ–π–∫—É–º')) {\n  \n  let response = `–ü—Ä–∏–≤–µ—Ç, ${userName}! üëã`;\n  \n  if (text.toLowerCase().includes('—Å–∞–ª–∞–º') || \n      text.toLowerCase().includes('—Å”ô–ª–µ–º') ||\n      text.toLowerCase().includes('—Å–∞–ª–∞–º–∞–ª–µ–π–∫—É–º')) {\n    response = `–£–∞–ª–µ–π–∫—É–º—Å–∞–ª–∞–º, ${userName}! ü§ù`;\n  }\n  \n  response += `\\n\\n–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? –ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ! üòä`;\n  \n  return {\n    json: {\n      response: response,\n      chatId: chatId,\n      useAI: false\n    }\n  };\n}\n\n// === –í–°–Å –û–°–¢–ê–õ–¨–ù–û–ï –ò–î–Å–¢ –í AI ===\n\nelse {\n  return {\n    json: {\n      question: text,\n      chatId: chatId,\n      useAI: true\n    }\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        208
      ],
      "id": "916d6fef-b28f-449d-a130-5d5764be3941",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.text }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1392,
        304
      ],
      "id": "793a36c8-3156-4b61-b615-0cc1bf15dc75",
      "name": "Send a text message",
      "webhookId": "c97da13d-3690-445c-a74e-26634e5e5988",
      "credentials": {
        "telegramApi": {
          "id": "NfxQdmu4lR5W3aCC",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d1e195ae-28fd-4610-bd0c-eb77e8e92a75",
              "leftValue": "={{ $json.useAI }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "e93aa78a-d081-408d-9ff7-4a8b448d295d",
              "leftValue": "={{ $json.hasPhoto }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -944,
        208
      ],
      "id": "27d9a43b-3a17-4a17-8d21-61e9ed65e927",
      "name": "If"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{ $json.question }}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -96,
        304
      ],
      "id": "735c0db1-f925-470c-a1f2-bd5dfe5962d5",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -16,
        176
      ],
      "id": "6644899c-4e03-4b4f-a633-b62979f7f226",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "R8YelDFoyot4BzjW",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–µ—Ä–µ–¥–∞–µ–º –æ–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–∞–ª—å—à–µ\nreturn {\n  json: {\n    text: $json.response,  // ‚Üê –ò–∑–º–µ–Ω–∏–ª–∏ text –Ω–∞ response!\n    chatId: $json.chatId\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        608
      ],
      "id": "b15c6f37-79b7-4f2d-86e2-aaa7e5a660b4",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4b356ea9-1cc2-4887-a98a-0330cc698c65",
              "name": "chatid",
              "value": "=={{ $json.chatId }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -320,
        304
      ],
      "id": "e49b73ec-8421-4517-94eb-fe729fc51eb3",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç LLM\nconst llmOutput = $input.item.json;\nconst aiResponse = llmOutput.output || llmOutput.text;\n\n// –ë–µ—Ä—ë–º chatId –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Edit Fields (–Ω–µ –∏–∑ —Ç–µ–∫—É—â–µ–π –Ω–æ–¥—ã!)\nconst chatId = $node[\"Edit Fields\"].json.chatId;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞\nif (!chatId) {\n  throw new Error('chatId –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Edit Fields!');\n}\n\nif (!aiResponse) {\n  throw new Error('AI –æ—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π!');\n}\n\nconsole.log('CHAT ID:', chatId);\nconsole.log('AI RESPONSE:', aiResponse);\n\nreturn {\n  json: {\n    text: aiResponse,\n    chatId: chatId\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        304,
        304
      ],
      "id": "ff42f20d-e367-4123-9ec4-230260d899f7",
      "name": "Format AI response"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e9030037-95c0-48f5-af5b-93072293736b",
              "leftValue": "={{ $json.hasPhoto }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -736,
        112
      ],
      "id": "257349aa-3a99-4f1c-992d-c50bda4dd093",
      "name": "check photo or text"
    },
    {
      "parameters": {
        "jsCode": "const visionData = $input.item.json;\nconst aiResponse = visionData.choices[0].message.content;\nconst chatId = $node[\"Get File Path\"].json.chatId;\n\nreturn {\n  json: {\n    text: \"üì∏ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:\\n\\n\" + aiResponse,\n    chatId: chatId\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        16
      ],
      "id": "f6d3cbaa-c46c-4cbd-9afd-63d3ad9d95c9",
      "name": "Format Vision Response"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.photoFileId }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -528,
        16
      ],
      "id": "e36afb48-34f3-44a6-9bd9-1dae226be754",
      "name": "Get a file",
      "webhookId": "109b866b-2651-49f2-94dd-02242af09c71",
      "credentials": {
        "telegramApi": {
          "id": "NfxQdmu4lR5W3aCC",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º caption –∏ chatId –∏–∑ –ø–µ—Ä–≤–æ–π –Ω–æ–¥—ã\nconst caption = $node[\"Code in JavaScript\"].json.photoCaption;\nconst chatId = $node[\"Code in JavaScript\"].json.chatId;\n\n// API –∫–ª—é—á OpenAI\nconst apiKey = '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'; // ‚Üê –í–°–¢–ê–í–¨–¢–ï!\n\n// –ß–∏—Ç–∞–µ–º binary –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ input\nconst binaryPropertyName = Object.keys($binary)[0];\nconst binaryData = $binary[binaryPropertyName];\n\nconsole.log('Binary property name:', binaryPropertyName);\nconsole.log('Binary data keys:', Object.keys(binaryData));\n\n// –ü–æ–ª—É—á–∞–µ–º base64 —á–µ—Ä–µ–∑ n8n helper\nconst buffer = await this.helpers.getBinaryDataBuffer(binaryPropertyName);\nconst base64String = buffer.toString('base64');\nconst mimeType = binaryData.mimeType || 'image/jpeg';\n\nconsole.log('Mime type:', mimeType);\nconsole.log('Base64 length:', base64String.length);\nconsole.log('Base64 preview:', base64String.substring(0, 50));\n\n// –°—Ç—Ä–æ–∏–º data URL\nconst dataUrl = `data:${mimeType};base64,${base64String}`;\n\n// –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞\nconst requestBody = {\n  model: 'gpt-4o',\n  messages: [\n    {\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text: `${caption}. –û—Ç–≤–µ—á–∞–π –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.`\n        },\n        {\n          type: 'image_url',\n          image_url: {\n            url: dataUrl,\n            detail: 'auto'\n          }\n        }\n      ]\n    }\n  ],\n  max_tokens: 1000\n};\n\n// –ó–∞–ø—Ä–æ—Å –∫ OpenAI\ntry {\n  const response = await this.helpers.httpRequest({\n    method: 'POST',\n    url: 'https://api.openai.com/v1/chat/completions',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${apiKey}`\n    },\n    body: requestBody,\n    json: true,\n    timeout: 60000\n  });\n\n  const aiResponse = response.choices[0].message.content;\n\n  return {\n    json: {\n      text: \"üì∏ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:\\n\\n\" + aiResponse,\n      chatId: chatId\n    }\n  };\n  \n} catch (error) {\n  console.error('Error:', JSON.stringify(error, null, 2));\n  \n  if (error.response && error.response.body) {\n    console.error('OpenAI Error:', JSON.stringify(error.response.body, null, 2));\n    throw new Error(`OpenAI: ${error.response.body.error?.message || JSON.stringify(error.response.body)}`);\n  }\n  \n  throw error;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "5fce5feb-47ed-4f91-988b-6404987f1329",
      "name": "Process Image with GPT-4"
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "check photo or text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Format AI response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format AI response": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check photo or text": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Vision Response": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Process Image with GPT-4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Image with GPT-4": {
      "main": [
        [
          {
            "node": "Format Vision Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "1d525cc0fa1f96e1c1660b06ed7ce6e40fc2c0bee579efd3b48af4e9d2ba43b8"
  }
}